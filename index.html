<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
		<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
		<![endif]-->
		<style>
			body {
				margin: 0;
				padding: 0;
			}
			#map {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}
		</style>

	</head>
	<body>
		<div id='map'></div>

		<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="vendor/esri-leaflet.min.js"></script>
		<script src="src/virtual-grid.js"></script>

		<script type='text/javascript'>
			// crank up path clipping for cooler demos. DON'T DO THIS IN PRODUCTION!
			L.Path.CLIP_PADDING = 10;

			// Make a Map
			var map = L.map('map').setView([45.5276173643906, -122.66736388203228], 16);

			// add our BasemapLayer
			var tiles = L.esri.basemapLayer("Gray").addTo(map);

			// add some extra labels as a second BasemapLayer
			var labels = L.esri.basemapLayer("GrayLabels").addTo(map);

			// make a new VirtualGrid
			var virtualGrid = L.virtualGrid({
				cellSizeMeters : 250
			});

			/**
			 * Define this method with the functionality needed
			 *
			 * @param {Event} e
			 */
			virtualGrid.on('newcells', function(e) {
				var this_ = e.target;
				for (var i = 0; i < e.cells.length; i++) {
					var cell = e.cells[i];
					(function(cell, i) {
						setTimeout(function() {

							var layer = L.rectangle(cell.bounds, {
								color : '#3ac1f0',
								weight : 2,
								opacity : 0.5,
								fillOpacity : 0.25
							});

							this_.cellsLayer.addLayer(layer);

							// debug.addLayer(L.circle(cell.center,cell.radius, {
							//   color: '#3ac1f0',
							//   weight: 2,
							//   opacity: 0.5,
							//   fillOpacity: 0.25
							// }));

						}, i);
					})(cell, i);
				}
			});

			/**
			 * Define this method with the functionality needed
			 *
			 * @param {Event} e
			 */
			virtualGrid.on('clearcells', function(e) {
				var this_ = e.target;
				this_.cellsLayer.clearLayers();
			});

			virtualGrid.addTo(map);
			
			new L.control.scale().addTo(map);

		</script>
	</body>
</html>